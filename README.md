Отчетность по оплатам за периоды.

Цель запроса:
Создание единого отчета о суммах оплат за все периоды, объединяющего данные из архивной системы (buy_archive) и текущей системы заказов.

Структура запроса:
Первая часть (архивные данные):
Берет данные из таблицы buy_archive
Группирует по году и месяцу оплаты
Считает общую сумму за каждый период
Вторая часть (текущие данные):
Собирает данные из связанных таблиц текущей системы
Фильтрует только завершенные оплаты
Группирует и суммирует аналогично архивным данным
Объединение: UNION ALL соединяет результаты обеих частей

Ключевые аспекты:
YEAR() и MONTHNAME() - функции для извлечения года и названия месяца из даты
SUM(buy_archive.amount * price) - расчет общей суммы (количество × цена)
WHERE date_step_end IS NOT NULL AND name_step = 'Оплата' - фильтр только завершенных оплат
ORDER BY Месяц, Год - сортировка для хронологического представления данных

Важные особенности:
Используется UNION ALL (вместо UNION) для сохранения всех строк, включая возможные дубликаты
Группировка выполняется по алиасам (Год, Месяц), что допустимо в некоторых СУБД
Запрос предполагает, что в обоих источниках данные согласованы по формату
